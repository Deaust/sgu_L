DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_D_CATEGORIA_01`(`p_CAT_ID` INT)
BEGIN
	UPDATE TM_CATEGORIA
	SET
		EST= 0
	WHERE
		CAT_ID = p_CAT_ID;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_D_COMPANIA_01`(`p_COM_ID` INT)
BEGIN
	UPDATE TM_COMPANIA
	SET
		EST= 0
	WHERE
		COM_ID = p_COM_ID;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_D_EMPRESA_01`(`p_EMP_ID` INT)
BEGIN
	UPDATE TM_EMPRESA
	SET
		EST= 0
	WHERE
		EMP_ID = p_EMP_ID;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_D_ROL_01`(`p_ROL_ID` INT)
BEGIN
	UPDATE TM_ROL
	SET
		EST= 0
	WHERE
		ROL_ID = p_ROL_ID;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_D_SUBCATEGORIA_01`(`p_CATS_ID` INT)
BEGIN
	UPDATE tm_subcategoria 
    set
		EST= 0
	WHERE
		cats_id = p_CATS_ID;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_D_SUCURSAL_01`(`p_SUC_ID` INT)
BEGIN
	UPDATE TM_SUCURSAL
	SET
		EST= 0
	WHERE
		SUC_ID = p_SUC_ID;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_D_USUARIO_01`(`p_USU_ID` INT)
BEGIN
	UPDATE TM_USUARIO
	SET
		EST= 0
	WHERE
		USU_ID = p_USU_ID;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_I_CATEGORIA_01`(`p_SUC_ID` INT, `p_CAT_NOM` VARCHAR(150))
BEGIN
	-- SQLINES LICENSE FOR EVALUATION USE ONLY
	INSERT INTO TM_CATEGORIA
	(SUC_ID,CAT_NOM,FECH_CREA,EST)
	VALUES
	(p_SUC_ID,p_CAT_NOM,NOW(3),1);
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_I_COMPANIA_01`(`p_COM_NOM` VARCHAR(150))
BEGIN
	-- SQLINES LICENSE FOR EVALUATION USE ONLY
	INSERT INTO TM_COMPANIA
	(COM_NOM,FECH_CREA,EST)
	VALUES
	(p_COM_NOM,NOW(3),1);
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_I_DOCUMENT_DETALLE_01`(`V_1` VARCHAR(150), `v_2` VARCHAR(150))
BEGIN
INSERT INTO td_documento_detalle (det_id,tickd_id,det_nom,est) VALUES (null,V_1,V_2,1);
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_I_EMPRESA_01`(`p_COM_ID` INT, `p_EMP_NOM` VARCHAR(150))
BEGIN
	-- SQLINES LICENSE FOR EVALUATION USE ONLY
	INSERT INTO TM_EMPRESA
	(COM_ID,EMP_NOM,FECH_CREA,EST)
	VALUES
	(p_COM_ID,p_EMP_NOM,NOW(3),1);
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_I_MENU_02`(`p_ROL_ID` INT)
BEGIN
	IF (SELECT COUNT(*) FROM TD_MENU WHERE ROL_ID=p_ROL_ID)=0
	THEN
		-- SQLINES LICENSE FOR EVALUATION USE ONLY
		INSERT INTO TD_MENU
		(MEN_ID,ROL_ID,MEND_PERMI,FECH_CREA,EST)
		(SELECT MEN_ID,p_ROL_ID,'No',NOW(3),1 FROM TM_MENU WHERE EST=1);
	ELSE
		-- SQLINES LICENSE FOR EVALUATION USE ONLY
		INSERT INTO TD_MENU
		(MEN_ID,ROL_ID,MEND_PERMI,FECH_CREA,EST)
		(SELECT MEN_ID,p_ROL_ID,'No',NOW(3),1 FROM TM_MENU WHERE EST=1 AND MEN_ID NOT IN (SELECT MEN_ID FROM TD_MENU WHERE ROL_ID=p_ROL_ID));
	END IF;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_I_ROL_01`(`p_ROL_NOM` VARCHAR(150))
BEGIN
	-- SQLINES LICENSE FOR EVALUATION USE ONLY
	INSERT INTO TM_ROL
	(ROL_NOM,FECH_CREA,EST)
	VALUES
	(p_ROL_NOM,NOW(3),1);
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_I_SUCURSAL_01`(`p_EMP_ID` INT, `p_SUC_NOM` VARCHAR(150))
BEGIN
	-- SQLINES LICENSE FOR EVALUATION USE ONLY
	INSERT INTO TM_SUCURSAL
	(EMP_ID,SUC_NOM,FECH_CREA,EST)
	VALUES
	(p_EMP_ID,p_SUC_NOM,NOW(3),1);
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_I_TICKDESCRIP_01`(`p_TICK_ID` INT, `p_USU_ID` INT, `p_TICKD_DESCRIP` MEDIUMTEXT)
BEGIN
	INSERT INTO td_ticketdetalle
	(tickd_id,tick_id,usu_id,tickd_descrip,fech_crea,est) 
	VALUES
	(NULL,p_TICK_ID,p_USU_ID,p_TICKD_DESCRIP, now(),'1');
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_I_USUARIO_01`(`p_SUC_ID` INT, `p_USU_CORREO` VARCHAR(150), `p_USU_NOM` VARCHAR(150), `p_USU_APE` VARCHAR(150), `p_USU_DNI` VARCHAR(150), `p_USU_TELF` VARCHAR(150), `p_USU_PASS` VARCHAR(150), `p_ROL_ID` INT, `p_USU_IMG` LONGTEXT)
BEGIN  
 -- SQLINES LICENSE FOR EVALUATION USE ONLY
 INSERT INTO TM_USUARIO  
 (SUC_ID,USU_CORREO,USU_NOM,USU_APE,USU_DNI,USU_TELF,USU_PASS,ROL_ID,USU_IMG,FECH_CREA,EST)  
 VALUES  
 (p_SUC_ID,p_USU_CORREO,p_USU_NOM,p_USU_APE,p_USU_DNI,p_USU_TELF,p_USU_PASS,p_ROL_ID,p_USU_IMG,NOW(3),1);  
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_CATEGORIA_01`(`p_SUC_ID` INT)
BEGIN  
 -- SQLINES LICENSE FOR EVALUATION USE ONLY
 SELECT 
	 CAT_ID,
	 SUC_ID,
	 CAT_NOM,
	 DATE_FORMAT(FECH_CREA,'%d/%m/%Y') AS FECH_CREA,
	 EST 
 FROM 
	TM_CATEGORIA  
 WHERE  
	 SUC_ID = p_SUC_ID  
	 AND EST=1;  
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_CATEGORIA_02`(`p_CAT_ID` INT)
BEGIN
	-- SQLINES LICENSE FOR EVALUATION USE ONLY
	SELECT * FROM TM_CATEGORIA
	WHERE
	CAT_ID = p_CAT_ID;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_CATEGORIA_03`(`p_SUC_ID` INT)
BEGIN

	-- SQLINES LICENSE FOR EVALUATION USE ONLY
	SELECT        
		TM_CATEGORIA.CAT_ID, 
		TM_CATEGORIA.CAT_NOM, 
		SUM(TM_PRODUCTO.PROD_STOCK) AS STOCK
	FROM            
		TM_CATEGORIA INNER JOIN
		TM_PRODUCTO ON TM_CATEGORIA.CAT_ID = TM_PRODUCTO.CAT_ID
	WHERE        
		TM_CATEGORIA.SUC_ID = 1
		AND TM_PRODUCTO.EST=1
		AND TM_CATEGORIA.EST=1
	GROUP BY
		TM_CATEGORIA.CAT_ID, 
		TM_CATEGORIA.CAT_NOM
	ORDER BY
		STOCK DESC;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_COMPANIA_01`()
BEGIN
	-- SQLINES LICENSE FOR EVALUATION USE ONLY
	SELECT * FROM TM_COMPANIA
	WHERE
	EST=1;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_COMPANIA_02`(`p_COM_ID` INT)
BEGIN
	-- SQLINES LICENSE FOR EVALUATION USE ONLY
	SELECT * FROM TM_COMPANIA
	WHERE
	COM_ID = p_COM_ID;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_COMPRAS_04`(`p_SUC_ID` INT)
BEGIN  
 -- SQLINES LICENSE FOR EVALUATION USE ONLY
 SELECT          
 TD_COMPRA_DETALLE.PROD_ID,   
 SUM(TD_COMPRA_DETALLE.DETC_CANT) AS CANT,   
 TM_PRODUCTO.PROD_NOM,   
 TM_PRODUCTO.PROD_PCOMPRA,   
 TM_CATEGORIA.CAT_NOM,   
 TM_UNIDAD.UND_NOM,   
 TM_PRODUCTO.PROD_STOCK,   
 TM_PRODUCTO.PROD_IMG,  
 TM_MONEDA.MON_NOM,  
 SUM(TM_COMPRA.COMPR_TOTAL) AS TOTAL  
 FROM              
 TD_COMPRA_DETALLE INNER JOIN  
 TM_PRODUCTO ON TD_COMPRA_DETALLE.PROD_ID = TM_PRODUCTO.PROD_ID INNER JOIN  
 TM_CATEGORIA ON TM_PRODUCTO.CAT_ID = TM_CATEGORIA.CAT_ID INNER JOIN  
 TM_UNIDAD ON TM_PRODUCTO.UND_ID = TM_UNIDAD.UND_ID INNER JOIN  
 TM_COMPRA ON TD_COMPRA_DETALLE.COMPR_ID = TM_COMPRA.COMPR_ID INNER JOIN  
 TM_MONEDA ON TM_COMPRA.MON_ID = TM_MONEDA.MON_ID  
 WHERE  
 TM_COMPRA.EST = 1  
 AND TM_PRODUCTO.EST=1  
 AND TM_COMPRA.SUC_ID = p_SUC_ID  
 GROUP BY   
 TD_COMPRA_DETALLE.PROD_ID,   
 TM_PRODUCTO.PROD_NOM,   
 TM_PRODUCTO.PROD_PCOMPRA,   
 TM_CATEGORIA.CAT_NOM,   
 TM_UNIDAD.UND_NOM,   
 TM_PRODUCTO.PROD_STOCK,   
 TM_PRODUCTO.PROD_IMG,  
 TM_MONEDA.MON_NOM  
 ORDER BY CANT DESC
 LIMIT 5;  
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_COMPRAVENTA_01`(`p_SUC_ID` INT)
BEGIN
-- SQLINES LICENSE FOR EVALUATION USE ONLY
SELECT * FROM 
	(
		SELECT              
		TM_COMPRA.COMPR_ID,       
		TM_COMPRA.SUC_ID,       
		TM_COMPRA.PAG_ID,       
		TM_COMPRA.PROV_ID,       
		TM_COMPRA.PROV_RUC,       
		TM_COMPRA.PROV_DIRECC,       
		TM_COMPRA.PROV_CORREO,       
		TM_COMPRA.COMPR_SUBTOTAL,       
		TM_COMPRA.COMPR_IGV,       
		TM_COMPRA.COMPR_TOTAL,       
		TM_COMPRA.COMPR_COMENT,       
		TM_COMPRA.USU_ID,       
		TM_COMPRA.MON_ID,       
		DATE_FORMAT (TM_COMPRA.FECH_CREA,'%d/%m/%Y') AS FECH_CREA,       
		TM_COMPRA.EST,       
		TM_SUCURSAL.SUC_NOM,       
		TM_EMPRESA.EMP_NOM,       
		TM_EMPRESA.EMP_RUC,       
		TM_EMPRESA.EMP_CORREO,       
		TM_EMPRESA.EMP_TELF,       
		TM_EMPRESA.EMP_DIRECC,       
		TM_EMPRESA.EMP_PAG,       
		TM_COMPANIA.COM_NOM,       
		TM_USUARIO.USU_CORREO,       
		TM_USUARIO.USU_NOM,       
		TM_USUARIO.USU_APE,       
		TM_USUARIO.USU_DNI,       
		TM_USUARIO.USU_TELF,     
		TM_USUARIO.USU_IMG,    
		TM_ROL.ROL_NOM,       
		TM_PAGO.PAG_NOM,       
		TM_MONEDA.MON_NOM,      
		TM_PROVEEDOR.PROV_NOM,  
		TM_DOCUMENTO.DOC_NOM,
		'Compra' as REGISTRO
		FROM                  
		TM_COMPRA INNER JOIN      
		TM_SUCURSAL ON TM_COMPRA.SUC_ID = TM_SUCURSAL.SUC_ID INNER JOIN      
		TM_EMPRESA ON TM_SUCURSAL.EMP_ID = TM_EMPRESA.EMP_ID INNER JOIN      
		TM_COMPANIA ON TM_EMPRESA.COM_ID = TM_COMPANIA.COM_ID INNER JOIN      
		TM_USUARIO ON TM_COMPRA.USU_ID = TM_USUARIO.USU_ID INNER JOIN      
		TM_ROL ON TM_USUARIO.ROL_ID = TM_ROL.ROL_ID INNER JOIN      
		TM_PAGO ON TM_COMPRA.PAG_ID = TM_PAGO.PAG_ID INNER JOIN      
		TM_MONEDA ON TM_COMPRA.MON_ID = TM_MONEDA.MON_ID INNER JOIN      
		TM_PROVEEDOR ON TM_COMPRA.PROV_ID = TM_PROVEEDOR.PROV_ID INNER JOIN  
		TM_DOCUMENTO ON TM_COMPRA.DOC_ID = TM_DOCUMENTO.DOC_ID  
		WHERE      
		TM_COMPRA.EST=1      
		AND TM_COMPRA.SUC_ID = p_SUC_ID

		UNION ALL
      
		SELECT                
		TM_VENTA.VENT_ID,         
		TM_VENTA.SUC_ID,         
		TM_VENTA.PAG_ID,         
		TM_VENTA.CLI_ID,         
		TM_VENTA.CLI_RUC,         
		TM_VENTA.CLI_DIRECC,         
		TM_VENTA.CLI_CORREO,         
		TM_VENTA.VENT_SUBTOTAL,         
		TM_VENTA.VENT_IGV,         
		TM_VENTA.VENT_TOTAL,         
		TM_VENTA.VENT_COMENT,         
		TM_VENTA.USU_ID,         
		TM_VENTA.MON_ID,         
		DATE_FORMAT(TM_VENTA.FECH_CREA,'%d/%m/%Y') AS FECH_CREA,        
		TM_VENTA.EST,         
		TM_SUCURSAL.SUC_NOM,         
		TM_EMPRESA.EMP_NOM,         
		TM_EMPRESA.EMP_RUC,         
		TM_EMPRESA.EMP_CORREO,         
		TM_EMPRESA.EMP_TELF,         
		TM_EMPRESA.EMP_DIRECC,         
		TM_EMPRESA.EMP_PAG,         
		TM_COMPANIA.COM_NOM,         
		TM_USUARIO.USU_CORREO,         
		TM_USUARIO.USU_NOM,         
		TM_USUARIO.USU_APE,         
		TM_USUARIO.USU_DNI,         
		TM_USUARIO.USU_TELF,         
		TM_USUARIO.USU_IMG,     
		TM_ROL.ROL_NOM,         
		TM_PAGO.PAG_NOM,         
		TM_MONEDA.MON_NOM,        
		TM_CLIENTE.CLI_NOM,  
		TM_DOCUMENTO.DOC_NOM,
		'Venta' AS REGISTRO
		FROM                    
		TM_VENTA INNER JOIN        
		TM_SUCURSAL ON TM_VENTA.SUC_ID = TM_SUCURSAL.SUC_ID INNER JOIN        
		TM_EMPRESA ON TM_SUCURSAL.EMP_ID = TM_EMPRESA.EMP_ID INNER JOIN        
		TM_COMPANIA ON TM_EMPRESA.COM_ID = TM_COMPANIA.COM_ID INNER JOIN        
		TM_USUARIO ON TM_VENTA.USU_ID = TM_USUARIO.USU_ID INNER JOIN        
		TM_ROL ON TM_USUARIO.ROL_ID = TM_ROL.ROL_ID INNER JOIN        
		TM_PAGO ON TM_VENTA.PAG_ID = TM_PAGO.PAG_ID INNER JOIN        
		TM_MONEDA ON TM_VENTA.MON_ID = TM_MONEDA.MON_ID INNER JOIN        
		TM_CLIENTE ON TM_VENTA.CLI_ID = TM_CLIENTE.CLI_ID INNER JOIN  
		TM_DOCUMENTO ON TM_VENTA.DOC_ID = TM_DOCUMENTO.DOC_ID  
		WHERE        
		TM_VENTA.EST=1        
		AND TM_VENTA.SUC_ID = p_SUC_ID  
	) TABLA
ORDER BY FECH_CREA DESC
LIMIT 20;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_DOCUMENTO_01`(`p_DOC_TIPO` VARCHAR(150))
BEGIN
	-- SQLINES LICENSE FOR EVALUATION USE ONLY
	SELECT * FROM TM_DOCUMENTO
	WHERE 
	EST=1
	AND DOC_TIPO = p_DOC_TIPO;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_EMPRESA_01`(`p_COM_ID` INT)
BEGIN
	-- SQLINES LICENSE FOR EVALUATION USE ONLY
	SELECT * FROM TM_EMPRESA
	WHERE
	COM_ID = p_COM_ID
	AND EST=1
    ORDER BY EMP_NOM;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_EMPRESA_02`(`p_EMP_ID` INT)
BEGIN
	-- SQLINES LICENSE FOR EVALUATION USE ONLY
	SELECT * FROM TM_EMPRESA
	WHERE
	EMP_ID = p_EMP_ID;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_MENU_01`(`p_ROL_ID` INT)
BEGIN
	-- SQLINES LICENSE FOR EVALUATION USE ONLY
	SELECT        
	TD_MENU.MEND_ID, 
	TD_MENU.MEN_ID, 
	TD_MENU.ROL_ID, 
	TD_MENU.MEND_PERMI, 
	TD_MENU.FECH_CREA, 
	TD_MENU.EST, 
	TM_MENU.MEN_NOM, 
	TM_MENU.MEN_RUTA, 
	TM_MENU.MEN_IDENTI,
	TM_MENU.MEN_GRUPO
	FROM            
	TD_MENU INNER JOIN
	TM_MENU ON TD_MENU.MEN_ID = TM_MENU.MEN_ID
	WHERE 
	TD_MENU.ROL_ID = p_ROL_ID;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_MENU_03`(`p_USU_ID` INT, `p_MEN_IDENTI` VARCHAR(100))
BEGIN  
	-- SQLINES LICENSE FOR EVALUATION USE ONLY
	SELECT        
	TD_MENU.MEND_ID, 
	TD_MENU.MEN_ID, 
	TD_MENU.ROL_ID, 
	TD_MENU.MEND_PERMI, 
	TD_MENU.FECH_CREA, 
	TD_MENU.EST, 
	TM_MENU.MEN_NOM, 
	TM_MENU.MEN_RUTA, 
	TM_MENU.MEN_IDENTI, 
	TM_MENU.MEN_GRUPO, 
	TM_USUARIO.USU_ID, 
	TM_ROL.ROL_NOM
	FROM            
	TD_MENU INNER JOIN
	TM_MENU ON TD_MENU.MEN_ID = TM_MENU.MEN_ID INNER JOIN
	TM_ROL ON TD_MENU.ROL_ID = TM_ROL.ROL_ID INNER JOIN
	TM_USUARIO ON TM_ROL.ROL_ID = TM_USUARIO.ROL_ID
 WHERE   
	TM_USUARIO.USU_ID=p_USU_ID  
	AND MEND_PERMI ='Si'
	AND TM_MENU.MEN_IDENTI =p_MEN_IDENTI;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_REPORTE_01`(`p_EMP_ID` INT)
BEGIN
SELECT
EMP_NOM,
SUC_NOM,
USU_NOM,
tm_ticket.USU_ID AS usuario,
(SELECT COUNT(*) FROM TM_TICKET WHERE TICK_ESTADO = 'Abierto' AND USU_ID = usuario GROUP BY USU_ID) as Levantados_A,
(SELECT COUNT(*) FROM TM_TICKET WHERE TICK_ESTADO = 'Cerrado' AND USU_ID = usuario GROUP BY USU_ID) as Levantados_C,
(SELECT COUNT(*) FROM TM_TICKET WHERE TICK_ESTADO = 'Cerrado' AND USU_ASIG = usuario GROUP BY USU_ASIG) as Asignados_C,
(SELECT COUNT(*) FROM TM_TICKET WHERE TICK_ESTADO = 'Abierto' AND USU_ASIG = usuario GROUP BY USU_ASIG) as Asignados_A
FROM 
TM_TICKET 
INNER JOIN TM_USUARIO ON TM_TICKET.USU_ID = TM_USUARIO.USU_ID
INNER JOIN TM_SUCURSAL ON TM_USUARIO.SUC_ID = TM_SUCURSAL.SUC_ID
INNER JOIN TM_EMPRESA ON TM_EMPRESA.EMP_ID = TM_SUCURSAL.EMP_ID
WHERE
TM_EMPRESA.EMP_ID = p_EMP_ID
group by 
USU_NOM
order by 
USU_NOM;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_ROL_01`()
BEGIN
	-- SQLINES LICENSE FOR EVALUATION USE ONLY
	SELECT * FROM TM_ROL
	WHERE
	EST=1;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_ROL_02`(`p_ROL_ID` INT)
BEGIN
	-- SQLINES LICENSE FOR EVALUATION USE ONLY
	SELECT * FROM TM_ROL
	WHERE
	ROL_ID = p_ROL_ID;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_SUBCATEGORIA_01`()
BEGIN
SELECT 
tm_subcategoria.cats_id,
tm_subcategoria.cat_id,
tm_subcategoria.cats_nom,
tm_categoria.cat_nom
FROM tm_subcategoria INNER JOIN
tm_categoria on tm_subcategoria.cat_id = tm_categoria.cat_id
WHERE 
tm_subcategoria.est=1;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_SUCURSAL_01`(`p_EMP_ID` INT)
BEGIN
	-- SQLINES LICENSE FOR EVALUATION USE ONLY
	SELECT 
    
    TM_EMPRESA.EMP_NOM,
    TM_SUCURSAL.SUC_NOM,
    TM_SUCURSAL.SUC_ID,
    TM_SUCURSAL.FECH_CREA
    FROM TM_SUCURSAL
    INNER JOIN TM_EMPRESA ON TM_SUCURSAL.EMP_ID = TM_EMPRESA.EMP_ID
	WHERE
	TM_EMPRESA.EMP_ID = p_EMP_ID
	AND TM_SUCURSAL.EST=1 
    ORDER BY SUC_NOM;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_SUCURSAL_02`(`p_SUC_ID` INT)
BEGIN
	-- SQLINES LICENSE FOR EVALUATION USE ONLY
	SELECT * FROM TM_SUCURSAL
	WHERE
	SUC_ID = p_SUC_ID;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_TICKET_01`(`p_USU_ID` INT)
BEGIN      
 -- SQLINES LICENSE FOR EVALUATION USE ONLY
 SELECT              
tm_ticket.tick_id,
tm_ticket.usu_id,
tm_categoria.cat_nom,
tm_ticket.tick_titulo,
tm_ticket.tick_descrip,
tm_ticket.tick_estado,
tm_ticket.fech_crea,
tm_ticket.fech_cierre,
tm_ticket.usu_asig,
tm_ticket.fech_asig,
tm_usuario.usu_nom,
tm_usuario.usu_ape,
tm_categoria.cat_nom,
tm_ticket.prio_id,
tm_prioridad.prio_nom
 FROM                  
TM_TICKET INNER JOIN 
TM_CATEGORIA ON TM_TICKET.CAT_ID = TM_CATEGORIA.CAT_ID INNER JOIN 
TM_USUARIO ON TM_TICKET.USU_ID = TM_USUARIO.USU_ID INNER JOIN 
TM_PRIORIDAD ON TM_TICKET.PRIO_ID = TM_PRIORIDAD.PRIO_ID 
 WHERE      
 
 TM_USUARIO.USU_ID = p_USU_ID;  
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_TICKET_02`(`p_EMP_ID` INT)
BEGIN
SELECT 
tm_ticket.tick_id,
tm_ticket.usu_id,
tm_categoria.cat_nom,
tm_sucursal.suc_nom,
tm_ticket.tick_titulo,
tm_ticket.tick_descrip,
tm_ticket.tick_estado,
tm_ticket.fech_crea,
tm_ticket.fech_cierre,
tm_ticket.usu_asig,
tm_ticket.fech_asig,
tm_usuario.usu_nom,
tm_usuario.usu_ape,
tm_categoria.cat_nom,
tm_ticket.prio_id,
tm_prioridad.prio_nom
FROM 
TM_TICKET 

INNER JOIN TM_CATEGORIA ON TM_TICKET.CAT_ID = TM_CATEGORIA.CAT_ID 
INNER JOIN TM_USUARIO ON TM_TICKET.USU_ID = TM_USUARIO.USU_ID 
INNER JOIN TM_PRIORIDAD ON TM_TICKET.PRIO_ID = TM_PRIORIDAD.PRIO_ID
INNER JOIN TM_SUCURSAL ON TM_CATEGORIA.SUC_ID = TM_SUCURSAL.SUC_ID 
INNER JOIN TM_EMPRESA ON TM_SUCURSAL.EMP_ID = TM_EMPRESA.EMP_ID 

WHERE

tm_empresa.emp_id= p_EMP_ID;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_TICKET_03`(`p_SUC_ID` INT)
BEGIN
SELECT 
tm_ticket.tick_id,
tm_ticket.usu_id,
tm_categoria.cat_nom,
tm_ticket.tick_titulo,
tm_ticket.tick_descrip,
tm_ticket.tick_estado,
tm_ticket.fech_crea,
tm_ticket.fech_cierre,
tm_ticket.usu_asig,
tm_ticket.fech_asig,
tm_usuario.usu_nom,
tm_usuario.usu_ape,
tm_categoria.cat_nom,
tm_ticket.prio_id,
tm_prioridad.prio_nom
FROM 
TM_TICKET 

INNER JOIN TM_CATEGORIA ON TM_TICKET.CAT_ID = TM_CATEGORIA.CAT_ID 
INNER JOIN TM_USUARIO ON TM_TICKET.USU_ID = TM_USUARIO.USU_ID 
INNER JOIN TM_PRIORIDAD ON TM_TICKET.PRIO_ID = TM_PRIORIDAD.PRIO_ID
INNER JOIN TM_SUCURSAL ON TM_CATEGORIA.SUC_ID = TM_SUCURSAL.SUC_ID 

WHERE

TM_SUCURSAL.SUC_ID= p_SUC_ID;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_TICKET_04`(`p_TICK_ID` INT)
BEGIN
SELECT
td_ticketdetalle.tickd_id,
td_ticketdetalle.tickd_descrip,
td_ticketdetalle.fech_crea,
tm_usuario.usu_nom,
tm_usuario.usu_ape,
tm_usuario.rol_id
FROM 
td_ticketdetalle
INNER join tm_usuario on td_ticketdetalle.usu_id = tm_usuario.usu_id
WHERE 
tick_id = p_TICK_ID;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_TICKET_05`(`p_TICK_ID` INT)
BEGIN
SELECT 
tm_ticket.tick_id,
tm_ticket.usu_id,
tm_ticket.cat_id,
tm_ticket.cats_id,
tm_ticket.tick_titulo,
tm_ticket.tick_descrip,
tm_ticket.tick_estado,
tm_ticket.fech_crea,
tm_ticket.fech_cierre,
tm_ticket.tick_estre,
tm_ticket.tick_coment,
tm_ticket.usu_asig,
tm_usuario.usu_nom,
tm_usuario.usu_ape,
tm_usuario.usu_correo,
tm_usuario.usu_telf,
tm_categoria.cat_nom,
tm_categoria.cat_correo,
tm_subcategoria.cats_nom,
tm_subcategoria.usu_id as usu_res,
tm_ticket.prio_id,
tm_prioridad.prio_nom,
tm_subcategoria.usu_id as usuario_subcategoria
FROM 
tm_ticket
INNER join tm_categoria on tm_ticket.cat_id = tm_categoria.cat_id
INNER join tm_subcategoria on tm_ticket.cats_id = tm_subcategoria.cats_id
INNER join tm_usuario on tm_ticket.usu_id = tm_usuario.usu_id
INNER join tm_prioridad on tm_ticket.prio_id = tm_prioridad.prio_id
WHERE
tm_ticket.est = 1 AND tm_ticket.tick_id = p_TICK_ID;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_TICKET_06`(`p_USU_ID` INT)
BEGIN
SELECT              
tm_ticket.tick_id,
tm_ticket.usu_id,
tm_categoria.cat_nom,
tm_ticket.tick_titulo,
tm_ticket.tick_descrip,
tm_ticket.tick_estado,
tm_ticket.fech_crea,
tm_ticket.fech_cierre,
tm_ticket.usu_asig,
tm_ticket.fech_asig,
tm_usuario.usu_nom,
tm_usuario.usu_ape,
tm_categoria.cat_nom,
tm_ticket.prio_id,
tm_prioridad.prio_nom
 FROM                  
TM_TICKET INNER JOIN 
TM_CATEGORIA ON TM_TICKET.CAT_ID = TM_CATEGORIA.CAT_ID INNER JOIN 
TM_USUARIO ON TM_TICKET.USU_ASIG = TM_USUARIO.USU_ID INNER JOIN 
TM_PRIORIDAD ON TM_TICKET.PRIO_ID = TM_PRIORIDAD.PRIO_ID 
 WHERE      
 
 TM_TICKET.USU_ASIG = p_USU_ID
AND tick_estado= 'Abierto';     
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_TICKET_07`(`p_TICK_ID` INT)
BEGIN      
 -- SQLINES LICENSE FOR EVALUATION USE ONLY
SELECT 
tm_ticket.tick_id,
tm_ticket.usu_id,
tm_ticket.cat_id,
tm_ticket.cats_id,
tm_ticket.tick_titulo,
tm_ticket.tick_descrip,
tm_ticket.tick_estado,
tm_ticket.fech_crea,
tm_ticket.fech_cierre,
tm_ticket.tick_estre,
tm_ticket.tick_coment,
tm_ticket.usu_asig,
tm_usuario.usu_nom,
tm_usuario.usu_ape,
tm_usuario.usu_correo,
tm_usuario.usu_telf,
tm_categoria.cat_nom,
tm_categoria.cat_correo,
tm_subcategoria.cats_nom,
tm_ticket.prio_id,
tm_prioridad.prio_nom
FROM 
tm_ticket
INNER join tm_categoria on tm_ticket.cat_id = tm_categoria.cat_id
INNER join tm_subcategoria on tm_ticket.cats_id = tm_subcategoria.cats_id
INNER join tm_usuario on tm_ticket.usu_asig = tm_usuario.usu_id
INNER join tm_prioridad on tm_ticket.prio_id = tm_prioridad.prio_id
WHERE
tm_ticket.est = 1 AND tm_ticket.tick_id = p_TICK_ID;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_TICKET_08`(`p_EMP_ID` INT)
BEGIN
SELECT 
tm_ticket.tick_id,
tm_ticket.usu_id,
tm_categoria.cat_nom,
tm_sucursal.suc_nom,
tm_ticket.tick_titulo,
tm_ticket.tick_descrip,
tm_ticket.tick_estado,
tm_ticket.fech_crea,
tm_ticket.fech_cierre,
tm_ticket.usu_asig,
tm_ticket.fech_asig,
tm_usuario.usu_nom,
tm_usuario.usu_ape,
tm_categoria.cat_nom,
tm_ticket.prio_id,
tm_prioridad.prio_nom
FROM 
TM_TICKET 

INNER JOIN TM_CATEGORIA ON TM_TICKET.CAT_ID = TM_CATEGORIA.CAT_ID 
INNER JOIN TM_USUARIO ON TM_TICKET.USU_ID = TM_USUARIO.USU_ID 
INNER JOIN TM_PRIORIDAD ON TM_TICKET.PRIO_ID = TM_PRIORIDAD.PRIO_ID
INNER JOIN TM_SUCURSAL ON TM_CATEGORIA.SUC_ID = TM_SUCURSAL.SUC_ID 
INNER JOIN TM_EMPRESA ON TM_SUCURSAL.EMP_ID = TM_EMPRESA.EMP_ID 

WHERE

tm_empresa.emp_id= p_EMP_ID;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_TICKET_09`(`p_SUC_ID` INT)
BEGIN
SELECT 
tm_ticket.tick_id,
tm_ticket.usu_id,
tm_categoria.cat_nom,
tm_ticket.tick_titulo,
tm_ticket.tick_descrip,
tm_ticket.tick_estado,
tm_ticket.fech_crea,
tm_ticket.fech_cierre,
tm_ticket.usu_asig,
tm_ticket.fech_asig,
tm_usuario.usu_nom,
tm_usuario.usu_ape,
tm_categoria.cat_nom,
tm_ticket.prio_id,
tm_prioridad.prio_nom
FROM 
TM_TICKET 

INNER JOIN TM_CATEGORIA ON TM_TICKET.CAT_ID = TM_CATEGORIA.CAT_ID 
INNER JOIN TM_USUARIO ON TM_TICKET.USU_ID = TM_USUARIO.USU_ID 
INNER JOIN TM_PRIORIDAD ON TM_TICKET.PRIO_ID = TM_PRIORIDAD.PRIO_ID
INNER JOIN TM_SUCURSAL ON TM_CATEGORIA.SUC_ID = TM_SUCURSAL.SUC_ID 

WHERE

TM_SUCURSAL.SUC_ID= p_SUC_ID;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_USUARIO_01`(`p_SUC_ID` INT)
BEGIN    
-- SQLINES LICENSE FOR EVALUATION USE ONLY
SELECT          
TM_USUARIO.USU_ID,   
TM_USUARIO.SUC_ID,   
TM_USUARIO.USU_CORREO,   
TM_USUARIO.USU_NOM,   
TM_USUARIO.USU_APE,   
TM_USUARIO.USU_DNI,   
TM_USUARIO.USU_TELF,   
TM_USUARIO.USU_PASS,  
TM_USUARIO.USU_IMG, 
TM_USUARIO.ROL_ID,   
TM_USUARIO.FECH_CREA,  
TM_ROL.ROL_NOM,   
TM_USUARIO.EST  
FROM              
TM_USUARIO INNER JOIN  
TM_ROL ON TM_USUARIO.ROL_ID = TM_ROL.ROL_ID  
WHERE    
TM_USUARIO.SUC_ID = p_SUC_ID    
AND TM_USUARIO.EST=1
AND TM_USUARIO.ROL_ID IN(10,12);   
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_USUARIO_02`(`p_USU_ID` INT)
BEGIN
	-- SQLINES LICENSE FOR EVALUATION USE ONLY
	SELECT * FROM TM_USUARIO
	WHERE
	USU_ID = p_USU_ID;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_USUARIO_03`(`p_USU_CORREO` VARCHAR(150), `p_USU_PASS` VARCHAR(50))
BEGIN
	-- SQLINES LICENSE FOR EVALUATION USE ONLY
	SELECT * FROM TM_USUARIO
	WHERE
	USU_CORREO = p_USU_CORREO
	AND USU_PASS = p_USU_PASS
	AND EST=1;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_USUARIO_04`(`p_SUC_ID` INT, `p_USU_CORREO` VARCHAR(50), `p_USU_PASS` VARCHAR(30))
BEGIN    
 -- SQLINES LICENSE FOR EVALUATION USE ONLY
 SELECT            

 TM_USUARIO.USU_ID,     
 TM_USUARIO.SUC_ID,     
 TM_USUARIO.USU_CORREO,     
 TM_USUARIO.USU_NOM,     
 TM_USUARIO.USU_APE,     
 TM_USUARIO.USU_DNI,     
 TM_USUARIO.USU_TELF,     
 TM_USUARIO.USU_PASS,     
 TM_USUARIO.ROL_ID,    
 TM_USUARIO.USU_IMG, 
 TM_SUCURSAL.EMP_ID,     
 TM_SUCURSAL.SUC_NOM,    
 TM_EMPRESA.EMP_ID,    
 TM_EMPRESA.EMP_NOM,     
 TM_EMPRESA.EMP_RUC,     
 TM_EMPRESA.COM_ID,     
 TM_COMPANIA.COM_NOM    
 FROM      
 TM_USUARIO INNER JOIN    
 TM_SUCURSAL ON TM_USUARIO.SUC_ID = TM_SUCURSAL.SUC_ID INNER JOIN    
 TM_EMPRESA ON TM_SUCURSAL.EMP_ID = TM_EMPRESA.EMP_ID INNER JOIN    
 TM_COMPANIA ON TM_EMPRESA.COM_ID = TM_COMPANIA.COM_ID    
 WHERE    
 TM_USUARIO.SUC_ID = p_SUC_ID     
 AND TM_USUARIO.USU_CORREO = p_USU_CORREO    
 AND TM_USUARIO.USU_PASS = p_USU_PASS    
 AND TM_USUARIO.EST = 1;    
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_USUARIO_05`()
BEGIN
SELECT          
TM_USUARIO.USU_ID,   
TM_USUARIO.SUC_ID,   
TM_USUARIO.USU_CORREO,   
TM_USUARIO.USU_NOM,   
TM_USUARIO.USU_APE,   
TM_USUARIO.USU_DNI,   
TM_USUARIO.USU_TELF,   
TM_USUARIO.USU_PASS,  
TM_USUARIO.USU_IMG, 
TM_USUARIO.ROL_ID,   
TM_USUARIO.FECH_CREA,  
TM_SUCURSAL.SUC_NOM,
TM_EMPRESA.EMP_NOM,
TM_ROL.ROL_NOM,   
TM_USUARIO.EST  
FROM              
TM_USUARIO INNER JOIN  
TM_ROL ON TM_USUARIO.ROL_ID = TM_ROL.ROL_ID  INNER JOIN 
TM_SUCURSAL ON TM_USUARIO.SUC_ID = TM_SUCURSAL.SUC_ID INNER JOIN 
TM_EMPRESA ON TM_SUCURSAL.EMP_ID = TM_EMPRESA.EMP_ID
WHERE      
TM_USUARIO.EST=1;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_USUARIO_06`(`p_EMP_ID` INT)
BEGIN
SELECT          
TM_USUARIO.USU_ID,   
TM_USUARIO.SUC_ID,   
TM_USUARIO.USU_CORREO,   
TM_USUARIO.USU_NOM,   
TM_USUARIO.USU_APE,   
TM_USUARIO.USU_DNI,   
TM_USUARIO.USU_TELF,   
TM_USUARIO.USU_PASS,  
TM_USUARIO.USU_IMG, 
TM_USUARIO.ROL_ID,   
TM_USUARIO.FECH_CREA,  
TM_SUCURSAL.SUC_NOM,
TM_EMPRESA.EMP_NOM,
TM_ROL.ROL_NOM,   
TM_USUARIO.EST  
FROM              
TM_USUARIO INNER JOIN  
TM_ROL ON TM_USUARIO.ROL_ID = TM_ROL.ROL_ID  INNER JOIN 
TM_SUCURSAL ON TM_USUARIO.SUC_ID = TM_SUCURSAL.SUC_ID INNER JOIN 
TM_EMPRESA ON TM_SUCURSAL.EMP_ID = TM_EMPRESA.EMP_ID   
WHERE      
TM_EMPRESA.EMP_ID=p_EMP_ID
AND
TM_USUARIO.EST=1;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_L_USUARIO_07`(`p_SUC_ID` INT)
BEGIN
SELECT          
TM_USUARIO.USU_ID,   
TM_USUARIO.SUC_ID,   
TM_USUARIO.USU_CORREO,   
TM_USUARIO.USU_NOM,   
TM_USUARIO.USU_APE,   
TM_USUARIO.USU_DNI,   
TM_USUARIO.USU_TELF,   
TM_USUARIO.USU_PASS,  
TM_USUARIO.USU_IMG, 
TM_USUARIO.ROL_ID,   
TM_USUARIO.FECH_CREA,  
TM_SUCURSAL.SUC_NOM,
TM_EMPRESA.EMP_NOM,
TM_ROL.ROL_NOM,   
TM_USUARIO.EST  
FROM              
TM_USUARIO INNER JOIN  
TM_ROL ON TM_USUARIO.ROL_ID = TM_ROL.ROL_ID  INNER JOIN 
TM_SUCURSAL ON TM_USUARIO.SUC_ID = TM_SUCURSAL.SUC_ID INNER JOIN 
TM_EMPRESA ON TM_SUCURSAL.EMP_ID = TM_EMPRESA.EMP_ID   
WHERE      
TM_SUCURSAL.SUC_ID=p_SUC_ID
AND
TM_USUARIO.EST=1;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_U_CATEGORIA_01`(`p_CAT_ID` INT, `p_SUC_ID` INT, `p_CAT_NOM` VARCHAR(150))
BEGIN
	UPDATE TM_CATEGORIA
	SET
		SUC_ID = p_SUC_ID,
		CAT_NOM = p_CAT_NOM
	WHERE
		CAT_ID = p_CAT_ID;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_U_COMPANIA_01`(`p_COM_ID` INT, `p_COM_NOM` VARCHAR(150))
BEGIN
	UPDATE TM_COMPANIA
	SET
		COM_NOM = p_COM_NOM
	WHERE
		COM_ID = p_COM_ID;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_U_EMPRESA_01`(`p_EMP_ID` INT, `p_COM_ID` INT, `p_EMP_NOM` VARCHAR(150))
BEGIN
	UPDATE TM_EMPRESA
	SET
		COM_ID = p_COM_ID,
		EMP_NOM = p_EMP_NOM
	WHERE
		EMP_ID = p_EMP_ID;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_U_MENU_01`(`p_MEND_ID` INT)
BEGIN
	UPDATE TD_MENU
	SET
		MEND_PERMI = 'Si'
	WHERE
		MEND_ID = p_MEND_ID;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_U_MENU_02`(`p_MEND_ID` INT)
BEGIN
	UPDATE TD_MENU
	SET
		MEND_PERMI = 'No'
	WHERE
		MEND_ID = p_MEND_ID;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_U_ROL_01`(`p_ROL_ID` INT, `p_ROL_NOM` VARCHAR(150))
BEGIN
	UPDATE TM_ROL
	SET
		ROL_NOM = p_ROL_NOM
	WHERE
		ROL_ID = p_ROL_ID;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_U_SUCURSAL_01`(`p_SUC_ID` INT, `p_EMP_ID` INT, `p_SUC_NOM` VARCHAR(150))
BEGIN
	UPDATE TM_SUCURSAL
	SET
		EMP_ID = p_EMP_ID,
		SUC_NOM = p_SUC_NOM
	WHERE
		SUC_ID = p_SUC_ID;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_U_TICKET_01`(`v_usu_asig` INT, `v_tick_id` INT)
BEGIN
update tm_ticket 
set	
	usu_asig = v_usu_asig,
	fech_asig = now()
where
	tick_id = v_tick_id;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_U_TICKET_02`(`v_tick_id` INT)
BEGIN
update tm_ticket 
                set	
                    tick_estado = 'Abierto'
                where
                    tick_id = v_tick_id;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_U_USUARIO_01`(`p_USU_ID` INT, `p_SUC_ID` INT, `p_USU_CORREO` VARCHAR(150), `p_USU_NOM` VARCHAR(150), `p_USU_APE` VARCHAR(150), `p_USU_DNI` VARCHAR(150), `p_USU_TELF` VARCHAR(150), `p_USU_PASS` VARCHAR(150), `p_ROL_ID` INT, `p_USU_IMG` LONGTEXT)
BEGIN  
 UPDATE TM_USUARIO  
 SET  
  SUC_ID = p_SUC_ID,  
  USU_CORREO = p_USU_CORREO,  
  USU_NOM = p_USU_NOM,  
  USU_APE = p_USU_APE,  
  USU_DNI = p_USU_DNI,  
  USU_TELF = p_USU_TELF,  
  USU_PASS = p_USU_PASS,  
  ROL_ID = p_ROL_ID,
  USU_IMG = p_USU_IMG
 WHERE  
  USU_ID = p_USU_ID;  
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `SP_U_USUARIO_02`(`p_USU_ID` INT, `p_USU_PASS` VARCHAR(50))
BEGIN
	UPDATE TM_USUARIO
	SET
		USU_PASS = p_USU_PASS
	WHERE
		USU_ID = p_USU_ID;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `filtrar_ticket`(IN `USU_ASIG` INT, IN `EMP_ID` INT, IN `SUC_ID` INT, IN `CAT_ID` INT, IN `CATS_ID` INT, IN `FECH_CREA_1` DATE, IN `FECH_CREA_2` DATE)
BEGIN
IF USU_ASIG = '' THEN            
SET USU_ASIG = NULL;
END IF;

IF EMP_ID = '' THEN            
SET EMP_ID = NULL;
END IF; 

IF SUC_ID = '' THEN            
SET SUC_ID = NULL;
END IF; 

IF CAT_ID = '' THEN            
SET CAT_ID = NULL;
END IF; 

IF CATS_ID = '' THEN            
SET CATS_ID = NULL;
END IF; 

IF FECH_CREA_1 = '' THEN            
SET FECH_CREA_1 = '2000-01-01';
END IF; 

IF FECH_CREA_2 = '' THEN            
SET FECH_CREA_2 = '3000-01-01';
END IF; 


SELECT
TM_USUARIO.USU_ID,
TM_USUARIO.USU_NOM,
TM_TICKET.FECH_CREA,
TM_TICKET.FECH_CIERRE,
TM_TICKET.USU_ASIG,
TICK_ID,
TICK_TITULO,
EMP_NOM,
SUC_NOM,
TICK_ESTADO,
CAT_NOM,
CATS_NOM,
tick_estre,
(SELECT TIMESTAMPDIFF(SECOND,tm_ticket.fech_crea, tm_ticket.fech_cierre))AS tiempo_cierre
FROM
tm_ticket
INNER JOIN TM_SUBCATEGORIA ON TM_TICKET.CATS_ID = TM_SUBCATEGORIA.CATS_ID 
INNER JOIN TM_CATEGORIA ON TM_TICKET.CAT_ID = TM_CATEGORIA.CAT_ID 
INNER JOIN TM_PRIORIDAD ON TM_TICKET.PRIO_ID = TM_PRIORIDAD.PRIO_ID
INNER JOIN TM_USUARIO ON TM_TICKET.USU_ID = TM_USUARIO.USU_ID
INNER JOIN TM_SUCURSAL ON TM_CATEGORIA.SUC_ID = TM_SUCURSAL.SUC_ID 
INNER JOIN TM_EMPRESA ON TM_SUCURSAL.EMP_ID = TM_EMPRESA.EMP_ID
WHERE
tm_ticket.est = 1
AND tm_ticket.USU_ASIG =  IFNULL(USU_ASIG,tm_ticket.USU_ASIG)
AND tm_sucursal.EMP_ID =  IFNULL(EMP_ID,tm_sucursal.EMP_ID)
AND tm_categoria.SUC_ID =  IFNULL(SUC_ID,tm_categoria.SUC_ID)
AND tm_ticket.CAT_ID =  IFNULL(CAT_ID,tm_ticket.CAT_ID)
AND tm_ticket.CATS_ID =  IFNULL(CATS_ID,tm_ticket.CATS_ID)
AND tm_ticket.fech_crea BETWEEN FECH_CREA_1 AND FECH_CREA_2	;


END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `filtrar_ticket_area`(IN `USU_ASIG` INT, IN `EMP_ID_p` INT, IN `SUC_ID` INT, IN `CAT_ID` INT, IN `CATS_ID` INT, IN `FECH_CREA_1` DATE, IN `FECH_CREA_2` DATE)
BEGIN
IF USU_ASIG = '' THEN            
SET USU_ASIG = NULL;
END IF;

IF SUC_ID = '' THEN            
SET SUC_ID = NULL;
END IF; 

IF CAT_ID = '' THEN            
SET CAT_ID = NULL;
END IF; 

IF CATS_ID = '' THEN            
SET CATS_ID = NULL;
END IF; 

IF FECH_CREA_1 = '' THEN            
SET FECH_CREA_1 = '2000-01-01';
END IF; 

IF FECH_CREA_2 = '' THEN            
SET FECH_CREA_2 = '3000-01-01';
END IF; 


SELECT
TM_USUARIO.USU_ID,
TM_USUARIO.USU_NOM,
TM_TICKET.FECH_CREA,
TM_TICKET.FECH_CIERRE,
TM_TICKET.USU_ASIG,
TICK_ID,
TICK_TITULO,
EMP_NOM,
SUC_NOM,
TICK_ESTADO,
CAT_NOM,
CATS_NOM,
tick_estre,
(SELECT TIMESTAMPDIFF(SECOND,tm_ticket.fech_crea, tm_ticket.fech_cierre))AS tiempo_cierre
FROM
tm_ticket
INNER JOIN TM_SUBCATEGORIA ON TM_TICKET.CATS_ID = TM_SUBCATEGORIA.CATS_ID 
INNER JOIN TM_CATEGORIA ON TM_TICKET.CAT_ID = TM_CATEGORIA.CAT_ID 
INNER JOIN TM_PRIORIDAD ON TM_TICKET.PRIO_ID = TM_PRIORIDAD.PRIO_ID
INNER JOIN TM_USUARIO ON TM_TICKET.USU_ID = TM_USUARIO.USU_ID
INNER JOIN TM_SUCURSAL ON TM_CATEGORIA.SUC_ID = TM_SUCURSAL.SUC_ID 
INNER JOIN TM_EMPRESA ON TM_SUCURSAL.EMP_ID = TM_EMPRESA.EMP_ID
WHERE
tm_ticket.est = 1
AND tm_ticket.USU_ASIG =  IFNULL(USU_ASIG,tm_ticket.USU_ASIG)
AND tm_sucursal.EMP_ID =  EMP_ID_p
AND tm_categoria.SUC_ID =  IFNULL(SUC_ID,tm_categoria.SUC_ID)
AND tm_ticket.CAT_ID =  IFNULL(CAT_ID,tm_ticket.CAT_ID)
AND tm_ticket.CATS_ID =  IFNULL(CATS_ID,tm_ticket.CATS_ID)
AND tm_ticket.fech_crea BETWEEN FECH_CREA_1 AND FECH_CREA_2	;


END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `filtrar_ticket_asig`(IN `USU_ASIG` INT, IN `EMP_ID` INT, IN `SUC_ID` INT, IN `CAT_ID` INT, IN `CATS_ID` INT, IN `FECH_CREA_1` DATE, IN `FECH_CREA_2` DATE,IN `p_USU_ID`INT)
BEGIN
IF USU_ASIG = '' THEN            
SET USU_ASIG = NULL;
END IF;

IF EMP_ID = '' THEN            
SET EMP_ID = NULL;
END IF; 

IF SUC_ID = '' THEN            
SET SUC_ID = NULL;
END IF; 

IF CAT_ID = '' THEN            
SET CAT_ID = NULL;
END IF; 

IF CATS_ID = '' THEN            
SET CATS_ID = NULL;
END IF; 

IF FECH_CREA_1 = '' THEN            
SET FECH_CREA_1 = '2000-01-01';
END IF; 

IF FECH_CREA_2 = '' THEN            
SET FECH_CREA_2 = '3000-01-01';
END IF; 


SELECT
TM_USUARIO.USU_ID,
TM_USUARIO.USU_NOM,
TM_TICKET.FECH_CREA,
TM_TICKET.FECH_CIERRE,
TM_TICKET.USU_ASIG,
TICK_ID,
TICK_TITULO,
EMP_NOM,
SUC_NOM,
TICK_ESTADO,
CAT_NOM,
CATS_NOM,
tick_estre,
(SELECT TIMESTAMPDIFF(SECOND,tm_ticket.fech_crea, tm_ticket.fech_cierre))AS tiempo_cierre
FROM
tm_ticket
INNER JOIN TM_SUBCATEGORIA ON TM_TICKET.CATS_ID = TM_SUBCATEGORIA.CATS_ID 
INNER JOIN TM_CATEGORIA ON TM_TICKET.CAT_ID = TM_CATEGORIA.CAT_ID 
INNER JOIN TM_PRIORIDAD ON TM_TICKET.PRIO_ID = TM_PRIORIDAD.PRIO_ID
INNER JOIN TM_USUARIO ON TM_TICKET.USU_ID = TM_USUARIO.USU_ID
INNER JOIN TM_SUCURSAL ON TM_CATEGORIA.SUC_ID = TM_SUCURSAL.SUC_ID 
INNER JOIN TM_EMPRESA ON TM_SUCURSAL.EMP_ID = TM_EMPRESA.EMP_ID
WHERE
tm_ticket.est = 1
AND tm_ticket.USU_ID =  IFNULL(USU_ASIG,tm_ticket.USU_ID)
AND tm_sucursal.EMP_ID =  IFNULL(EMP_ID,tm_sucursal.EMP_ID)
AND tm_categoria.SUC_ID =  IFNULL(SUC_ID,tm_categoria.SUC_ID)
AND tm_ticket.CAT_ID =  IFNULL(CAT_ID,tm_ticket.CAT_ID)
AND tm_ticket.CATS_ID =  IFNULL(CATS_ID,tm_ticket.CATS_ID)
AND tm_ticket.fech_crea BETWEEN FECH_CREA_1 AND FECH_CREA_2	
AND tm_ticket.USU_ASIG = p_USU_ID;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `filtrar_ticket_dep`(IN `USU_ASIG` INT, IN `CAT_ID` INT, IN `CATS_ID` INT, IN `FECH_CREA_1` DATE, IN `FECH_CREA_2` DATE, IN `usu_dep` INT)
BEGIN
IF USU_ASIG = '' THEN            
SET USU_ASIG = NULL;
END IF;

IF CAT_ID = '' THEN            
SET CAT_ID = NULL;
END IF; 

IF CATS_ID = '' THEN            
SET CATS_ID = NULL;
END IF; 

IF FECH_CREA_1 = '' THEN            
SET FECH_CREA_1 = '2000-01-01';
END IF; 

IF FECH_CREA_2 = '' THEN            
SET FECH_CREA_2 = '3000-01-01';
END IF; 


SELECT
TM_USUARIO.USU_ID,
TM_USUARIO.USU_NOM,
TM_TICKET.FECH_CREA,
TM_TICKET.FECH_CIERRE,
TM_TICKET.USU_ASIG,
TICK_ID,
TICK_TITULO,
EMP_NOM,
SUC_NOM,
TICK_ESTADO,
CAT_NOM,
CATS_NOM,
tick_estre,
(SELECT TIMESTAMPDIFF(SECOND,tm_ticket.fech_crea, tm_ticket.fech_cierre))AS tiempo_cierre
FROM
tm_ticket
INNER JOIN TM_SUBCATEGORIA ON TM_TICKET.CATS_ID = TM_SUBCATEGORIA.CATS_ID 
INNER JOIN TM_CATEGORIA ON TM_TICKET.CAT_ID = TM_CATEGORIA.CAT_ID 
INNER JOIN TM_PRIORIDAD ON TM_TICKET.PRIO_ID = TM_PRIORIDAD.PRIO_ID
INNER JOIN TM_USUARIO ON TM_TICKET.USU_ID = TM_USUARIO.USU_ID
INNER JOIN TM_SUCURSAL ON TM_CATEGORIA.SUC_ID = TM_SUCURSAL.SUC_ID 
INNER JOIN TM_EMPRESA ON TM_SUCURSAL.EMP_ID = TM_EMPRESA.EMP_ID
WHERE
tm_ticket.est = 1
AND tm_ticket.USU_ASIG =  IFNULL(USU_ASIG,tm_ticket.USU_ASIG)
AND tm_sucursal.SUC_ID =  usu_dep
AND tm_ticket.CAT_ID =  IFNULL(CAT_ID,tm_ticket.CAT_ID)
AND tm_ticket.CATS_ID =  IFNULL(CATS_ID,tm_ticket.CATS_ID)
AND tm_ticket.fech_crea BETWEEN FECH_CREA_1 AND FECH_CREA_2;


END$$
DELIMITER ;
